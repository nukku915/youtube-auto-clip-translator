# ドキュメントレビュー・改善提案

## 概要

全ドキュメント（00〜07）をレビューし、不足・改善点を洗い出した。

---

## 1. 横断的な課題（全体に影響）

### 1.1 アーキテクチャ・設計

| 課題 | 説明 | 優先度 |
|------|------|--------|
| **モジュール間依存関係図がない** | どのモジュールがどのモジュールを呼ぶか不明確 | 高 |
| **統一エラーコード体系がない** | 各モジュールで独自エラー。統一ルールが必要 | 高 |
| **ログ戦略が未定義** | ログレベル、フォーマット、保存場所、ローテーション | 中 |
| **config.yamlの完全スキーマがない** | 設定ファイルの全項目定義が散在 | 中 |
| **イベント/コールバック定義が曖昧** | モジュール間通信の型定義 | 中 |

### 1.2 制約・制限の明文化不足

| 課題 | 現状 | 提案 |
|------|------|------|
| **最大動画長** | 未定義 | 「2時間まで」など明記 |
| **最大ファイルサイズ** | 未定義 | 入力・出力の上限 |
| **対応言語ペア** | 「日⇔英」のみ言及 | 他言語の対応可否を明確化 |
| **同時処理数** | 未定義 | メモリ・CPU考慮した上限 |
| **オフラインモード** | Gemini使えない時の動作が曖昧 | 明確なフォールバック動作 |

### 1.3 セキュリティ

| 課題 | 説明 |
|------|------|
| **入力サニタイズ** | URL、ファイル名のバリデーション方針 |
| **一時ファイルの権限** | ファイルパーミッションの明記 |
| **APIキー漏洩対策** | メモリ上のキー保護、ログへの出力抑制 |
| **外部コマンド実行** | FFmpeg等のコマンドインジェクション対策 |

### 1.4 パフォーマンス・リソース管理

| 課題 | 説明 |
|------|------|
| **メモリ使用量上限** | 長時間動画処理時のメモリ管理 |
| **ディスククリーンアップ** | 一時ファイルの自動削除タイミング |
| **CPU/GPU使用率制御** | 他アプリへの影響を抑える設定 |
| **キャッシュ戦略統一** | モジュールごとにバラバラ → 統一 |

---

## 2. 各ドキュメントの詳細課題

### 2.1 00_design_decisions.md

| 課題 | 説明 |
|------|------|
| 決定理由(Why)が薄い | なぜその方式を選んだか、代替案は何だったか |
| トレードオフの明記 | 各決定のメリット・デメリット |
| 変更履歴 | いつ、なぜ決定が変わったか |

### 2.2 01_video_fetcher.md

| 課題 | 説明 |
|------|------|
| **プレイリスト対応** | 複数動画の一括処理対応の有無 |
| **ライブ配信アーカイブ** | 処理方法、制限事項 |
| **Cookie対応の詳細** | 年齢制限動画のCookie取得・設定方法 |
| **プロキシ設定のUI** | ユーザーがどう設定するか |
| **ダウンロード中断・再開** | 大容量動画での対応 |
| **字幕ダウンロード** | 既存字幕がある場合の活用 |

### 2.3 02_audio_processor.md

| 課題 | 説明 |
|------|------|
| **多言語混在の処理** | 1動画内で複数言語が話される場合 |
| **ノイズ対策詳細** | BGM、環境音が酷い場合の対処 |
| **HuggingFaceトークン** | pyannote用トークン取得手順の案内 |
| **モデルキャッシュ場所** | WhisperXモデルの保存先明記 |
| **ストリーミング処理** | 長時間動画のメモリ効率処理 |
| **GPU VRAM不足時の動作** | 自動フォールバックの詳細 |

### 2.4 03_ai_analyzer.md

| 課題 | 説明 |
|------|------|
| **プロンプトバージョン管理** | プロンプト変更時の互換性 |
| **翻訳品質検証** | 機械翻訳の品質チェック方法 |
| **コスト監視機能** | API使用量の可視化、アラート |
| **Ollama起動失敗時** | 詳細なトラブルシューティング |
| **レスポンスパース失敗時** | JSONパースエラーの対処 |
| **部分的成功の扱い** | 100セグメント中10個だけ失敗した場合 |
| **コンテキスト長超過** | 長文の分割・統合方法 |

### 2.5 04_subtitle_generator.md

| 課題 | 説明 |
|------|------|
| **特殊文字エスケープ** | ASS形式での{}等の扱い |
| **RTL言語対応** | アラビア語、ヘブライ語 |
| **絵文字対応** | フォント・表示の考慮 |
| **フォントフォールバック** | 指定フォントがない場合 |
| **行数が多い時の分割** | 3行以上になる場合の処理 |
| **読み速度の自動調整** | 文字数と表示時間の自動最適化 |

### 2.6 05_video_editor.md

| 課題 | 説明 |
|------|------|
| **複数音声トラック** | 多言語音声の扱い |
| **キーフレーム問題** | 正確な切り出しのための再エンコード判断 |
| **フレーム単位精度** | ミリ秒指定 vs フレーム指定 |
| **一時ファイルクリーンアップ** | 処理完了・エラー時の削除タイミング |
| **プログレス計算方法** | 複数ステップの進捗率算出 |
| **FFmpegエラー解析** | エラー出力のパース・ユーザー表示 |
| **音声・映像の同期ズレ対策** | 切り抜き結合時のズレ防止 |

### 2.7 06_gui.md

| 課題 | 説明 |
|------|------|
| **ウィンドウサイズ制約** | 最小サイズ、推奨サイズ |
| **高DPI/Retina対応** | スケーリング処理 |
| **複数モニタ対応** | ウィンドウ復元位置 |
| **Undo/Redo実装詳細** | コマンドパターンの設計 |
| **ドラッグ&ドロップ詳細** | URL/ファイルのD&D対応 |
| **フォーカス管理** | Tab順序、キーボードナビゲーション |
| **エラー表示UI** | エラー時のダイアログ・トースト使い分け |
| **初回起動オンボーディング** | 初回ユーザーへのガイド |
| **進捗バーの粒度** | 各処理ステップの重み付け |
| **多言語UI** | 切り替えの実装詳細 |

### 2.8 07_exporter.md

| 課題 | 説明 |
|------|------|
| **YouTube直接アップロード** | 将来対応の検討 |
| **動画メタデータ埋め込み** | タイトル、著者、説明文 |
| **サムネイル自動生成** | ハイライト部分からの切り出し |
| **並行出力のリソース管理** | メモリ・CPU制限 |
| **部分出力の再開** | エラー時の途中からの再開 |
| **出力プリセット保存** | ユーザー定義プリセット |

---

## 3. 欠けているドキュメント

以下のドキュメントの新規作成を推奨:

| ドキュメント | 内容 |
|-------------|------|
| **ARCHITECTURE.md** | 全体アーキテクチャ図、モジュール依存関係、データフロー |
| **ERROR_CODES.md** | 統一エラーコード体系、ユーザー向けメッセージ |
| **LOGGING.md** | ログ戦略、レベル定義、フォーマット |
| **CONFIG_SCHEMA.md** | config.yamlの完全スキーマ定義 |
| **TROUBLESHOOTING.md** | よくある問題と解決方法 |
| **GLOSSARY.md** | 用語集（セグメント、チャプター、プロジェクト等の定義） |

---

## 4. データモデルの課題

### 4.1 モデル間の関連が不明確

```
Project
  ├─ VideoMetadata  ← 定義済み
  ├─ TranscriptionResult  ← 定義済み
  ├─ TranslationResult  ← 定義済み
  ├─ EditSegment  ← 定義済み
  ├─ SubtitleEntry  ← 定義済み
  └─ ??? Chapter との関連は？
```

### 4.2 不足しているモデル定義

| モデル | 説明 |
|--------|------|
| **AppConfig** | 全設定の統合モデル |
| **ProcessingState** | 処理状態の詳細（キャンセル可能か等） |
| **ErrorInfo** | 統一エラー情報 |
| **ExportPreset** | ユーザー保存プリセット |

---

## 5. ワークフローの課題

### 5.1 例外フロー

以下のケースの動作が未定義:

| ケース | 現状 |
|--------|------|
| 動画が著作権で削除された | ? |
| 文字起こし結果が空 | ? |
| 翻訳APIが長時間応答なし | ? |
| エンコード中にディスク満杯 | ? |
| ネットワーク切断後の復帰 | ? |

### 5.2 中断・再開フロー

| ケース | 現状 |
|--------|------|
| ダウンロード中断後の再開 | 未定義 |
| 文字起こし中断後の再開 | 未定義 |
| エンコード中断後の再開 | 未定義 |

---

## 6. UI/UXの課題

### 6.1 アクセシビリティ

| 課題 | 説明 |
|------|------|
| スクリーンリーダー対応 | 未考慮 |
| 色覚多様性対応 | カラースキームの検討 |
| キーボードのみ操作 | 全機能がキーボードで操作可能か |

### 6.2 ユーザビリティ

| 課題 | 説明 |
|------|------|
| ツールチップ | 各ボタン・機能の説明 |
| ヘルプ機能 | コンテキストヘルプ |
| エラーメッセージ | 技術的でない表現 |
| 確認ダイアログ | 破壊的操作前の確認 |

---

## 7. テスト戦略の課題

### 7.1 手動テストの詳細不足

| 課題 | 説明 |
|------|------|
| テストケース詳細 | 具体的な手順がない |
| テストデータ | 使用する動画サンプル |
| 期待結果 | 合否判定基準 |
| リグレッションテスト | 変更後の確認項目 |

### 7.2 テスト環境

| 課題 | 説明 |
|------|------|
| 各OS固有のテスト | Windows/macOS/Linux差異 |
| GPU有無のテスト | CPU-only環境での確認 |
| ネットワーク環境 | オフライン、低速回線 |

---

## 8. 優先度別改善アクション

### 高優先度（実装前に必須）

1. **ARCHITECTURE.md作成** - モジュール依存関係の明確化
2. **統一エラーコード体系** - ERROR_CODES.md作成
3. **config.yaml完全スキーマ** - CONFIG_SCHEMA.md作成
4. **制約条件の明文化** - 最大動画長、対応言語等

### 中優先度（実装中に対応）

5. ログ戦略定義
6. 例外フローの詳細化
7. UI/UXの詳細設計（D&D、Undo/Redo）
8. 各モジュールの課題対応

### 低優先度（リリース前に対応）

9. トラブルシューティングガイド
10. 用語集作成
11. アクセシビリティ対応
12. テストケース詳細化

---

## 9. 次のアクション

- [ ] この改善リストを確認・優先度調整
- [ ] 高優先度の課題から対応開始
- [ ] 各ドキュメントへの追記 or 新規ドキュメント作成

