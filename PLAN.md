# YouTube自動切り抜き翻訳ツール - マスター計画書

## 1. プロジェクト概要

### 目的
YouTube動画から切り抜き動画を自動生成し、翻訳字幕を付与するデスクトップアプリケーション

### 主要機能
- YouTube動画のダウンロード
- 音声からの文字起こし（多言語対応）
- AI による翻訳（双方向：日本語⇔英語）
- AI による見どころ検出・チャプター分割・タイトル生成
- 字幕生成（音声波形に同期）
- 動画編集（切り抜き・字幕焼き付け・タイトルカットイン）
- 通常動画 (16:9) / Shorts (9:16) 両対応

### ターゲットユーザー
- コンテンツクリエイター
- 翻訳者
- 動画編集者

---

## 2. システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                        GUI Layer                                │
│                    (CustomTkinter)                              │
├─────────────────────────────────────────────────────────────────┤
│                     Application Layer                           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ Project  │ │ Workflow │ │  State   │ │  Config  │           │
│  │ Manager  │ │ Engine   │ │ Manager  │ │ Manager  │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
├─────────────────────────────────────────────────────────────────┤
│                      Core Modules                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  Video   │ │  Audio   │ │    AI    │ │ Subtitle │           │
│  │ Fetcher  │ │Processor │ │ Analyzer │ │Generator │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐ ┌──────────┐                                      │
│  │  Video   │ │  Export  │                                      │
│  │  Editor  │ │  Module  │                                      │
│  └──────────┘ └──────────┘                                      │
├─────────────────────────────────────────────────────────────────┤
│                    External Dependencies                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  yt-dlp  │ │  FFmpeg  │ │ WhisperX │ │  Gemini  │           │
│  │  + Deno  │ │          │ │          │ │   API    │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 技術スタック

### 言語・ランタイム
| 項目 | 選定 | バージョン |
|------|------|-----------|
| 言語 | Python | 3.10+ |
| JSランタイム | Deno | 最新 (yt-dlp依存) |

### コア依存関係
| 機能 | ライブラリ | 用途 |
|------|-----------|------|
| 動画取得 | yt-dlp | YouTube動画ダウンロード |
| 音声/動画処理 | FFmpeg | 音声抽出・動画編集・エンコード |
| 文字起こし | WhisperX | 音声認識 + VAD + word-level timestamps |
| 翻訳・AI分析 | Gemini 3 Flash API | 翻訳・見どころ検出・チャプター・タイトル生成 |
| 字幕処理 | pysubs2 | SRT/ASS/VTT生成 |
| GUI | CustomTkinter | デスクトップUI |

### 補助ライブラリ
| 機能 | ライブラリ | 用途 |
|------|-----------|------|
| 音声波形 | librosa | 波形可視化 |
| 設定管理 | pydantic | 設定バリデーション |
| 非同期処理 | asyncio | バックグラウンド処理 |

---

## 4. モジュール構成

```
src/
├── main.py                 # エントリーポイント
├── config/
│   ├── settings.py         # アプリ設定
│   └── constants.py        # 定数定義
├── core/
│   ├── video_fetcher/      # 動画取得モジュール
│   ├── audio_processor/    # 音声処理モジュール
│   ├── ai_analyzer/        # AI分析モジュール
│   ├── subtitle_generator/ # 字幕生成モジュール
│   ├── video_editor/       # 動画編集モジュール
│   └── exporter/           # 出力モジュール
├── gui/
│   ├── app.py              # メインウィンドウ
│   ├── components/         # UIコンポーネント
│   └── views/              # 各画面
├── models/
│   ├── project.py          # プロジェクトデータ
│   ├── segment.py          # セグメント（切り抜き区間）
│   └── subtitle.py         # 字幕データ
└── utils/
    ├── file_utils.py       # ファイル操作
    └── time_utils.py       # 時間変換
```

---

## 5. 処理フロー概要

```
Phase 1: 取得・前処理（ローカル処理）
┌─────────────────────────────────────────────────────────────┐
│ [URL入力] → [動画DL] → [音声抽出] → [文字起こし]            │
│                                       (WhisperX)            │
│                                       ↓                     │
│                              [タイムスタンプ付きテキスト]    │
└─────────────────────────────────────────────────────────────┘

Phase 2: AI分析（API呼び出し・低コスト）
┌─────────────────────────────────────────────────────────────┐
│ [テキスト分析] → 見どころスコアリング                        │
│               → チャプター区切り検出                         │
│               → セクションタイトル生成                       │
└─────────────────────────────────────────────────────────────┘

Phase 3: 人間によるレビュー（GUI）
┌─────────────────────────────────────────────────────────────┐
│ [プレビュー] → 切り抜き範囲調整                              │
│             → チャプター調整                                 │
│             → タイトル編集                                   │
└─────────────────────────────────────────────────────────────┘

Phase 4: 翻訳（API呼び出し・確定部分のみ）
┌─────────────────────────────────────────────────────────────┐
│ [確定セグメントのみ翻訳] → コスト最適化                      │
└─────────────────────────────────────────────────────────────┘

Phase 5: 書き出し（ローカル処理）
┌─────────────────────────────────────────────────────────────┐
│ [動画編集] → 切り抜き                                        │
│           → 字幕焼き付け                                     │
│           → タイトルカットイン                               │
│           → フォーマット変換 (16:9 / 9:16)                   │
│                    ↓                                         │
│           [完成動画 + 字幕ファイル]                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 詳細計画書一覧

各モジュールの詳細仕様は以下のドキュメントを参照：

| # | ドキュメント | 内容 |
|---|-------------|------|
| 1 | [docs/01_video_fetcher.md](docs/01_video_fetcher.md) | 動画取得モジュール |
| 2 | [docs/02_audio_processor.md](docs/02_audio_processor.md) | 音声処理・文字起こしモジュール |
| 3 | [docs/03_ai_analyzer.md](docs/03_ai_analyzer.md) | AI分析モジュール（翻訳・検出） |
| 4 | [docs/04_subtitle_generator.md](docs/04_subtitle_generator.md) | 字幕生成モジュール |
| 5 | [docs/05_video_editor.md](docs/05_video_editor.md) | 動画編集モジュール |
| 6 | [docs/06_gui.md](docs/06_gui.md) | GUIモジュール |
| 7 | [docs/07_exporter.md](docs/07_exporter.md) | 出力・エクスポートモジュール |

---

## 7. 非機能要件

### パフォーマンス
- 10分の動画を5分以内に処理（GPU使用時）
- CPU-onlyでも動作（処理時間は長くなる）

### 互換性
- Windows 10/11
- macOS 12+ (Apple Silicon対応)
- Linux (Ubuntu 22.04+)

### セキュリティ
- APIキーはローカルに暗号化保存
- 動画データはローカル処理のみ（外部送信なし、翻訳テキスト除く）

---

## 8. 開発フェーズ

### Phase 1: MVP（最小実行可能製品）
- [ ] 動画取得
- [ ] 文字起こし
- [ ] 翻訳
- [ ] 字幕ファイル出力
- [ ] 基本GUI

### Phase 2: 編集機能
- [ ] 切り抜き編集
- [ ] 字幕焼き付け
- [ ] チャプター機能

### Phase 3: AI自動化
- [ ] 見どころ自動検出
- [ ] タイトル自動生成
- [ ] Shorts自動変換

### Phase 4: 拡張
- [ ] バッチ処理
- [ ] プリセット保存
- [ ] 多言語対応拡張

---

## 9. 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-19 | 1.0 | 初版作成 |
