# YouTube自動切り抜き翻訳ツール - マスター計画書

## 1. プロジェクト概要

### 目的
YouTube動画から切り抜き動画を自動生成し、翻訳字幕を付与するデスクトップアプリケーション

### 主要機能
- YouTube動画のダウンロード
- 音声からの文字起こし（多言語対応）
- AI による翻訳（双方向：日本語⇔英語）
- AI による見どころ検出・チャプター分割・タイトル生成
- 字幕生成（音声波形に同期）
- 動画編集（切り抜き・字幕焼き付け・タイトルカットイン）
- 通常動画 (16:9) / Shorts (9:16) 両対応

### ターゲットユーザー
- コンテンツクリエイター
- 翻訳者
- 動画編集者

---

## 2. システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────┐
│                        GUI Layer                                │
│                    (CustomTkinter)                              │
├─────────────────────────────────────────────────────────────────┤
│                     Application Layer                           │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ Project  │ │ Workflow │ │  State   │ │  Config  │           │
│  │ Manager  │ │ Engine   │ │ Manager  │ │ Manager  │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
├─────────────────────────────────────────────────────────────────┤
│                      Core Modules                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  Video   │ │  Audio   │ │    AI    │ │ Subtitle │           │
│  │ Fetcher  │ │Processor │ │ Analyzer │ │Generator │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐ ┌──────────┐                                      │
│  │  Video   │ │  Export  │                                      │
│  │  Editor  │ │  Module  │                                      │
│  └──────────┘ └──────────┘                                      │
├─────────────────────────────────────────────────────────────────┤
│                    External Dependencies                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │  yt-dlp  │ │  FFmpeg  │ │ WhisperX │ │  Gemini  │           │
│  │  + Deno  │ │   + mpv  │ │          │ │   API    │           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
│  ┌──────────┐                                                   │
│  │  Ollama  │  ← ローカルLLM（ハイブリッド構成）                │
│  └──────────┘                                                   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 技術スタック

### 言語・ランタイム
| 項目 | 選定 | バージョン |
|------|------|-----------|
| 言語 | Python | 3.10+ |
| JSランタイム | Deno | 最新 (yt-dlp依存) |

### コア依存関係
| 機能 | ライブラリ | 用途 |
|------|-----------|------|
| 動画取得 | yt-dlp | YouTube動画ダウンロード |
| 音声/動画処理 | FFmpeg | 音声抽出・動画編集・エンコード |
| 文字起こし | WhisperX | 音声認識 + VAD + word-level timestamps |
| AI分析（ローカル） | Ollama + gemma-2-jpn | 見どころ検出・チャプター検出 |
| AI分析（クラウド） | Gemini 3 Flash API | 翻訳・タイトル生成 |
| 字幕処理 | pysubs2 | SRT/ASS/VTT生成 |
| GUI | CustomTkinter | デスクトップUI |

### 補助ライブラリ
| 機能 | ライブラリ | 用途 |
|------|-----------|------|
| 動画プレビュー | python-mpv | mpv埋め込みプレーヤー |
| 音声波形 | librosa | 波形可視化 |
| 設定管理 | pydantic | 設定バリデーション |
| 非同期処理 | asyncio | バックグラウンド処理 |

### 外部ツール（自動インストール対象）
| ツール | 用途 | インストール方法 |
|--------|------|-----------------|
| FFmpeg | 動画処理・エンコード | バイナリ自動DL |
| Deno | yt-dlp依存 | 公式インストーラー |
| mpv | プレビュー再生 | バイナリ自動DL |
| Ollama | ローカルLLM | 公式インストーラー + モデルDL |

---

## 4. モジュール構成

```
src/
├── main.py                 # エントリーポイント
├── config/
│   ├── settings.py         # アプリ設定
│   └── constants.py        # 定数定義
├── core/
│   ├── video_fetcher/      # 動画取得モジュール
│   ├── audio_processor/    # 音声処理モジュール
│   ├── ai_analyzer/        # AI分析モジュール
│   ├── subtitle_generator/ # 字幕生成モジュール
│   ├── video_editor/       # 動画編集モジュール
│   └── exporter/           # 出力モジュール
├── gui/
│   ├── app.py              # メインウィンドウ
│   ├── components/         # UIコンポーネント
│   └── views/              # 各画面
├── models/
│   ├── project.py          # プロジェクトデータ
│   ├── segment.py          # セグメント（切り抜き区間）
│   └── subtitle.py         # 字幕データ
└── utils/
    ├── file_utils.py       # ファイル操作
    └── time_utils.py       # 時間変換
```

---

## 5. 処理フロー概要

```
Phase 1: 取得・前処理（ローカル処理）
┌─────────────────────────────────────────────────────────────┐
│ [URL入力] → [動画DL] → [音声抽出] → [文字起こし]            │
│                                       (WhisperX)            │
│                                       ↓                     │
│                              [タイムスタンプ付きテキスト]    │
└─────────────────────────────────────────────────────────────┘

Phase 2: AI分析（ハイブリッドLLM）
┌─────────────────────────────────────────────────────────────┐
│ [テキスト分析]                                               │
│   ├─ ローカルLLM (Ollama) → 見どころスコアリング            │
│   │                        → チャプター区切り検出            │
│   └─ クラウドLLM (Gemini) → セクションタイトル生成          │
└─────────────────────────────────────────────────────────────┘

Phase 3: 人間によるレビュー（GUI）
┌─────────────────────────────────────────────────────────────┐
│ [プレビュー] → 切り抜き範囲調整                              │
│             → チャプター調整                                 │
│             → タイトル編集                                   │
└─────────────────────────────────────────────────────────────┘

Phase 4: 翻訳（クラウドLLM・確定部分のみ）
┌─────────────────────────────────────────────────────────────┐
│ [確定セグメントのみ翻訳] → Gemini API使用                    │
│                          → 高品質な翻訳が必要なためクラウド  │
└─────────────────────────────────────────────────────────────┘

Phase 5: 書き出し（ローカル処理）
┌─────────────────────────────────────────────────────────────┐
│ [動画編集] → 切り抜き                                        │
│           → 字幕焼き付け                                     │
│           → タイトルカットイン                               │
│           → フォーマット変換 (16:9 / 9:16)                   │
│                    ↓                                         │
│           [完成動画 + 字幕ファイル]                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 詳細計画書一覧

各モジュールの詳細仕様は以下のドキュメントを参照：

| # | ドキュメント | 内容 |
|---|-------------|------|
| 0 | [docs/00_design_decisions.md](docs/00_design_decisions.md) | **設計決定事項（実装方針）** |
| 1 | [docs/01_video_fetcher.md](docs/01_video_fetcher.md) | 動画取得モジュール |
| 2 | [docs/02_audio_processor.md](docs/02_audio_processor.md) | 音声処理・文字起こしモジュール |
| 3 | [docs/03_ai_analyzer.md](docs/03_ai_analyzer.md) | AI分析モジュール（翻訳・検出） |
| 4 | [docs/04_subtitle_generator.md](docs/04_subtitle_generator.md) | 字幕生成モジュール |
| 5 | [docs/05_video_editor.md](docs/05_video_editor.md) | 動画編集モジュール |
| 6 | [docs/06_gui.md](docs/06_gui.md) | GUIモジュール |
| 7 | [docs/07_exporter.md](docs/07_exporter.md) | 出力・エクスポートモジュール |

---

## 7. 非機能要件

### パフォーマンス
- 10分の動画を5分以内に処理（GPU使用時）
- CPU-onlyでも動作（処理時間は長くなる）

### 互換性
- Windows 10/11
- macOS 12+ (Apple Silicon対応)
- Linux (Ubuntu 22.04+)

### セキュリティ
- APIキーは設定ファイルに保存（GUIから設定）
- 動画データはローカル処理のみ（外部送信なし、翻訳テキスト除く）

### データ管理
- プロジェクトは30秒ごとに自動保存
- 処理中のアプリ終了は確認ダイアログで保護

---

## 8. 開発フェーズ

### Phase 1: MVP（最小実行可能製品）
- [ ] 動画取得
- [ ] 文字起こし
- [ ] 翻訳
- [ ] 字幕ファイル出力
- [ ] 基本GUI

### Phase 2: 編集機能
- [ ] 切り抜き編集
- [ ] 字幕焼き付け
- [ ] チャプター機能

### Phase 3: AI自動化
- [ ] 見どころ自動検出
- [ ] タイトル自動生成
- [ ] Shorts自動変換

### Phase 4: 拡張
- [ ] バッチ処理
- [ ] プリセット保存
- [ ] 多言語対応拡張

---

## 9. MVP実装タスク

### 実装順序

```
1. 環境構築
   └─ pyproject.toml作成、依存関係インストール

2. データモデル（models/）
   └─ project.py, transcription.py, translation.py

3. 設定（config/）
   └─ settings.py

4. コアモジュール（core/）※順番に実装・動作確認
   ├─ video_fetcher.py    → docs/01参照
   ├─ audio_processor.py  → docs/02参照
   ├─ transcriber.py      → docs/02参照
   ├─ translator.py       → docs/03参照（Geminiのみ）
   └─ subtitle_writer.py  → docs/04参照

5. CLI動作確認
   └─ main.py でURL→SRT出力を確認

6. GUI（gui/）
   ├─ app.py（メインウィンドウ）
   ├─ views/main_view.py（URL入力、進捗）
   └─ views/settings_view.py（API設定）

7. 仕上げ
   ├─ エラーハンドリング
   └─ 外部ツール確認ダイアログ
```

### タスク一覧

| # | タスク | 参照ドキュメント | 状態 |
|---|--------|-----------------|------|
| 1 | pyproject.toml作成 | - | [ ] |
| 2 | src/ディレクトリ構造作成 | - | [ ] |
| 3 | models/ 実装 | 各docs参照 | [ ] |
| 4 | config/settings.py 実装 | docs/00 | [ ] |
| 5 | core/video_fetcher.py | docs/01 | [ ] |
| 6 | core/audio_processor.py | docs/02 | [ ] |
| 7 | core/transcriber.py | docs/02 | [ ] |
| 8 | core/translator.py | docs/03 | [ ] |
| 9 | core/subtitle_writer.py | docs/04 | [ ] |
| 10 | main.py (CLI) | - | [ ] |
| 11 | gui/app.py | docs/06 | [ ] |
| 12 | gui/views/ | docs/06 | [ ] |
| 13 | エラーハンドリング強化 | docs/00 | [ ] |

---

## 10. 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-19 | 1.0 | 初版作成 |
| 2026-01-19 | 1.2 | MVP実装タスクリストを追加 |
| 2026-01-19 | 1.1 | ハイブリッドLLM構成（Ollama + Gemini）を追加 |
