"""League of Legends 用語辞書."""
import json
import re
from pathlib import Path

# チャンピオン名辞書（韓国語/誤認識 → 正しい日本語）
CHAMPIONS = {
    # A
    "아트록스": "エイトロックス", "아트 록스": "エイトロックス", "아트": "エイトロックス",
    "アトロックス": "エイトロックス", "アートロックス": "エイトロックス",
    "아리": "アーリ", "아칼리": "アカリ",
    "알리스타": "アリスター", "아무무": "アムム",
    "애니비아": "アニビア", "애니": "アニー",
    "아펠리오스": "アフェリオス", "애쉬": "アッシュ",
    "아우렐리온 솔": "オレリオン・ソル",
    "아지르": "アジール",

    # B
    "바드": "バード", "블리츠크랭크": "ブリッツクランク", "브랜드": "ブランド",
    "브라움": "ブラウム", "베이가": "ベイガー",

    # C
    "카밀": "カミール", "카시오페아": "カシオペア", "케이틀린": "ケイトリン",
    "초가스": "チョ=ガス", "코르키": "コーキ",

    # D
    "다리우스": "ダリウス", "다이애나": "ダイアナ", "드레이븐": "ドレイヴン",
    "닥터 문도": "ドクター・ムンド",

    # E
    "에코": "エコー", "엘리스": "エリス", "이블린": "イブリン",
    "이즈리얼": "エズリアル",

    # F
    "피들스틱": "フィドルスティックス", "피오라": "フィオラ", "피즈": "フィズ",

    # G
    "갈리오": "ガリオ", "갱플랭크": "ガングプランク", "가렌": "ガレン",
    "나르": "ナー", "그라가스": "グラガス", "그레이브즈": "グレイブス",
    "그웬": "グウェン", "가위": "グウェン(ハサミ)",

    # H
    "헤카림": "ヘカリム", "하이머딩거": "ハイマーディンガー",

    # I
    "일라오이": "イラオイ", "이렐리아": "イレリア", "아이번": "アイバーン",

    # J
    "자나": "ジャンナ", "자르반 4세": "ジャーヴァンIV", "잭스": "ジャックス",
    "제이스": "ジェイス", "진": "ジン", "징크스": "ジンクス",

    # K
    "카이사": "カイ=サ", "칼리스타": "カリスタ", "카르마": "カルマ",
    "카서스": "カーサス", "카사딘": "カサディン", "카타리나": "カタリナ",
    "케인": "ケイン", "케넨": "ケネン", "카직스": "カ=ジックス",
    "킨드레드": "キンドレッド", "클레드": "クレッド", "코그모": "コグ=マウ",
    "크산테": "クサンテ",

    # L
    "르블랑": "ル・ブラン", "리신": "リー・シン", "레오나": "レオナ",
    "릴리아": "リリア", "리산드라": "リサンドラ", "루시안": "ルシアン",
    "룰루": "ルル", "럭스": "ラックス",

    # M
    "말파이트": "マルファイト", "말자하": "マルザハール", "마오카이": "マオカイ",
    "마스터 이": "マスター・イー", "미스 포츈": "ミス・フォーチュン",
    "모데카이저": "モルデカイザー", "모르가나": "モルガナ",

    # N
    "나미": "ナミ", "나서스": "ナサス", "노틸러스": "ノーチラス",
    "니코": "ニーコ", "니달리": "ニダリー", "녹턴": "ノクターン",
    "누누": "ヌヌ",

    # O
    "올라프": "オラフ", "오리아나": "オリアナ", "오른": "オーン",

    # P
    "판테온": "パンテオン", "파이크": "パイク", "포피": "ポッピー",

    # Q
    "퀸": "クイン", "키아나": "キヤナ",

    # R
    "라칸": "ラカン", "람머스": "ラムス", "렉사이": "レク=サイ",
    "렐": "レル", "렝가": "レンガー", "리븐": "リヴェン",
    "럼블": "ランブル", "라이즈": "ライズ",

    # S
    "사미라": "サミーラ", "세주아니": "セジュアニ", "세나": "セナ",
    "세라핀": "セラフィーン", "세트": "セト", "샤코": "シャコ",
    "쉔": "シェン", "쉬바나": "シヴァーナ", "신지드": "シンジド",
    "사이온": "サイオン", "사이엔": "サイオン", "사이언": "サイオン",
    "시비르": "シヴィア", "스카너": "スカーナー", "소나": "ソナ",
    "소라카": "ソラカ", "스웨인": "スウェイン", "사일러스": "サイラス",
    "신드라": "シンドラ",

    # T
    "탈리야": "タリヤ", "탈론": "タロン", "타릭": "タリック",
    "티모": "ティーモ", "쓰레쉬": "スレッシュ", "트리스타나": "トリスターナ",
    "트런들": "トランドル", "트린다미어": "トリンダメア", "트위스티드 페이트": "ツイステッド・フェイト",
    "트위치": "トゥイッチ",

    # U
    "우디르": "ウディア", "우르곳": "アーゴット",

    # V
    "바루스": "ヴァルス", "베인": "ヴェイン", "베이가": "ベイガー",
    "벨코즈": "ヴェル=コズ", "바이": "ヴァイ", "비에고": "ヴィエゴ",
    "빅토르": "ビクター", "블라디미르": "ブラッドミア", "볼리베어": "ボリベア",

    # W
    "워윅": "ワーウィック", "우콩": "ウーコン",

    # X
    "자야": "ザヤ", "제라스": "ゼラス", "신짜오": "シン・ジャオ",

    # Y
    "야스오": "ヤスオ", "요네": "ヨネ", "요릭": "ヨリック", "유미": "ユーミ",

    # Z
    "자크": "ザック", "제드": "ゼド", "지그스": "ジグス",
    "질리언": "ジリアン", "조이": "ゾーイ", "자이라": "ザイラ",
}

# スキル名・略称
SKILLS = {
    # グウェン
    "가위": "ハサミ(グウェンQ)",
    "가위부터": "ハサミから",

    # オリアナ
    "오리": "オリアナ",
    "볼": "ボール(オリアナ)",

    # アニー
    "애니": "アニー",
    "언니": "アニー",  # 姉さん→アニー

    # その他チャンピオン略称
    "그라가스": "グラガス",
    "그라겟": "グラガス",
    "이즈": "イズリアル",
    "루시": "ルシアン",
    "카이사": "カイ=サ",
    "카직": "カ=ジックス",
    "리신": "リー・シン",
    "리 신": "リー・シン",
    "야스오": "ヤスオ",
    "야스": "ヤスオ",
    "요네": "ヨネ",

    # スキル略称
    "궁": "ウルト",
    "궁극기": "ウルト",
    "평타": "AA",
    "스킬": "スキル",
    "패시브": "パッシブ",
    "점멸": "フラッシュ",
    "플래시": "フラッシュ",
    "플래": "フラッシュ",
    "점화": "イグナイト",
    "강타": "スマイト",
    "텔포": "テレポート",
    "순간이동": "テレポート",
    "정화": "クレンズ",
    "탈진": "イグゾースト",
    "유체화": "ゴースト",
    "방어막": "バリア",
    "회복": "ヒール",
}

# ゲーム用語辞書
GAME_TERMS = {
    # 韓国語 → 日本語
    "탱": "タンク", "탱커": "タンカー", "탱킹": "タンキング",
    "딜": "ダメージ", "딜러": "ダメージディーラー",
    "힐": "ヒール", "힐러": "ヒーラー",
    "버프": "バフ", "디버프": "デバフ",
    "cc": "CC", "씨씨": "CC",
    "갱": "ガンク", "갱킹": "ガンク",
    "로밍": "ローミング", "로밍": "ローム",
    "티피": "TP", "텔포": "テレポート",
    "플래시": "フラッシュ", "점멸": "フラッシュ",
    "이그나이트": "イグナイト", "점화": "イグナイト",
    "베리어": "バリア",
    "고스트": "ゴースト", "유체화": "ゴースト",
    "힐": "ヒール", "회복": "ヒール",
    "클렌즈": "クレンズ", "정화": "クレンズ",
    "이그": "イグゾースト", "탈진": "イグゾースト",
    "스매시": "スマイト", "강타": "スマイト",
    "오브젝트": "オブジェクト", "오브젝": "オブジェクト",
    "바론": "バロン", "남작": "バロン",
    "드래곤": "ドラゴン", "용": "ドラゴン",
    "엘더": "エルダードラゴン",
    "전령": "リフトヘラルド", "헤럴드": "ヘラルド",
    "타워": "タワー", "포탑": "タワー",
    "인힙": "インヒビター", "억제기": "インヒビター",
    "넥서스": "ネクサス",
    "미니언": "ミニオン",
    "정글": "ジャングル", "정글러": "ジャングラー",
    "미드": "ミッド", "미드라이너": "ミッドレーナー",
    "탑": "トップ", "탑라이너": "トップレーナー",
    "원딜": "ADC", "ad캐리": "ADC",
    "서폿": "サポート", "서포터": "サポート",
    "라인전": "レーン戦",
    "팀파이트": "チームファイト", "팀파": "チームファイト", "한타": "集団戦",
    "스플릿": "スプリットプッシュ", "스플릿푸쉬": "スプリットプッシュ",
    "풀콘": "フルコンボ", "풀콤": "フルコンボ",
    "이니시": "イニシエート", "이니시에이트": "イニシエート",
    "필": "フィール", "필체크": "フィールチェック", "시야": "視界",
    "와딩": "ワーディング", "와드": "ワード",
    "솔킬": "ソロキル",
    "어시": "アシスト", "어시스트": "アシスト",
    "킬": "キル",
    "데스": "デス",
    "cs": "CS", "시에스": "CS",
    "카정": "カウンタージャングル",
    "궁": "ウルト", "궁극기": "アルティメット",
    "스킬": "スキル",
    "패시브": "パッシブ",
    "트레이드": "トレード",

    # 誤認識されやすい英語
    "tragedy": "トレード",
    "trade": "トレード",

    # 韓国チームボイス用語（追加）
    "킬각": "キルアングル",
    "실피": "激ロー",
    "개피": "激ロー",
    "딸피": "瀕死",
    "미아": "MIA(見えない)",
    "묶여있다": "固まってる",
    "다이브": "タワーダイブ",
    "리쉬": "リーシュ",
    "인베": "インベード",
    "인베이드": "インベード",
    "푸시": "プッシュ",
    "파밍": "ファーム",
    "킬딸": "KS",
    "캐리": "キャリー",
    "스노우볼": "スノーボール",
    "필밴": "必須BAN",
    "천상계": "高レート",
    "극후반": "レイトゲーム",
    "원챔": "ワントリック",
    "장인": "職人/OTP",

    # 方向・位置
    "위": "上",
    "아래": "下",
    "왼쪽": "左",
    "오른쪽": "右",
    "앞": "前",
    "뒤": "後ろ",

    # コールアウト
    "간다": "行く",
    "온다": "来る",
    "빠져": "引いて",
    "들어가": "入って",
    "때려": "殴れ",
    "잡아": "捕まえろ",
    "봐": "見て",
    "조심": "気をつけて",
    "좋아": "いいね",
    "나이스": "ナイス",
    "오케이": "オッケー",
    "ㄱㄱ": "ゴーゴー",

    # 韓国プロ用語
    "갓": "ゴッド/神",
    "영고": "一人で頑張る人",
    "의문사": "謎の死",
    "천상계": "高レート帯",
    "심해": "低レート",
    "고인": "弱チャンプ",
    "입롤": "口だけ",
    "장인": "OTP/職人",
    "자르다": "カットする",
    "추노": "追いかける",
    "버스": "キャリーする",
    "낚시": "ベイト/釣り",
    "터지다": "爆発する/やられる",
    "똥싸다": "フィードする",

    # 試合中コール
    "가자": "行こう",
    "물러나": "引け",
    "돌아": "戻れ",
    "기다려": "待って",
    "싸워": "戦え",
    "도망가": "逃げろ",
    "도와줘": "助けて",
    "위험해": "危ない",
    "끝났어": "終わった",
    "이겼어": "勝った",
    "졌어": "負けた",
}

# アイテム名
ITEMS = {
    # 神話アイテム・伝説アイテム
    "무한의 대검": "インフィニティ・エッジ",
    "삼위일체": "トリニティ・フォース",
    "지크 컨버전스": "ジーク・コンバージェンス",
    "가고일 스톤플레이트": "ガーゴイル・ストーンプレート",
    "솔라리의 펜던트": "ソラリのロケット",
    "란두인의 예언": "ランデュイン・オーメン",
    "가시갑옷": "ソーンメイル",
    "정령의 형상": "スピリットビサージュ",

    # 追加アイテム
    "얼어붙은 심장": "フローズンハート",
    "수호천사": "ガーディアンエンジェル",
    "가디언 엔젤": "ガーディアンエンジェル",
    "가엔": "GA",
    "존야의 모래시계": "ゾーニャの砂時計",
    "존야": "ゾーニャ",
    "라바돈의 죽음모자": "ラバドン・デスキャップ",
    "모자": "帽子(ラバドン)",
    "루덴의 폭풍": "ルーデン・テンペスト",
    "리안드리의 고뇌": "リアンドリー・トーメント",
    "모렐로노미콘": "モレロノミコン",
    "나셔의 이빨": "ナッシャー・トゥース",
    "마법공학 로켓벨트": "ヘクステック・ロケットベルト",
    "밴시의 장막": "バンシー・ヴェール",
    "머큐리얼의 장도": "マーキュリアル・シミター",
    "수은": "QSS/水銀",
    "칼날비바람": "ナヴォリ・クイックブレード",
    "도미닉 경의 인사": "ドミニク・リガード",
    "모탈 리마인더": "モータル・リマインダー",
    "무라마나": "ムラマナ",
    "블랙 클리버": "ブラック・クリーバー",
    "선혈포식자": "ブラッドサースター",
}

# LCK チーム名
TEAMS = {
    "한화생명": "ハンファ生命",
    "젠지": "Gen.G",
    "티원": "T1",
    "케이티": "KT Rolster",
    "디알엑스": "DRX",
    "농심": "NS RedForce",
    "리브 샌박": "Liiv SANDBOX",
    "광동": "Kwangdong Freecs",
    "OK저축은행": "OK BRION",
    "디플러스 기아": "Dplus KIA",
}

# LCK 選手名（ゲーム内ネーム ↔ 本名）
PLAYERS = {
    # T1
    "도란": "Doran", "최현준": "Doran", "ドラン": "Doran",
    "오너": "Oner", "문현준": "Oner", "オナー": "Oner",
    "페이커": "Faker", "이상혁": "Faker", "フェイカー": "Faker",
    "구마유시": "Gumayusi", "이민형": "Gumayusi", "クマユシ": "Gumayusi",
    "케리아": "Keria", "류민석": "Keria", "ケリア": "Keria",
    "페이즈": "Peyz", "ペイズ": "Peyz",
    "제우스": "Zeus", "최우제": "Zeus", "ゼウス": "Zeus",

    # Gen.G
    "기인": "Kiin", "김기인": "Kiin", "キイン": "Kiin",
    "캐니언": "Canyon", "김건부": "Canyon", "キャニオン": "Canyon",
    "쵸비": "Chovy", "정지훈": "Chovy", "チョビー": "Chovy",
    "룰러": "Ruler", "박재혁": "Ruler", "ルーラー": "Ruler",
    "듀로": "Duro", "デューロ": "Duro",
    "레헨즈": "Lehends", "손시우": "Lehends", "リヘンズ": "Lehends",

    # Hanwha Life
    "피넛": "Peanut", "한왕호": "Peanut", "ピーナッツ": "Peanut",
    "제카": "Zeka", "ゼカ": "Zeka",
    "바이퍼": "Viper", "パイパー": "Viper",
    "딜라이트": "Delight", "ディライト": "Delight",

    # DRX
    "리치": "Rich", "이재원": "Rich", "リッチ": "Rich",
    "스펀지": "Sponge", "배영준": "Sponge", "スポンジ": "Sponge",
    "유칼": "ucal", "손우현": "ucal", "ユカル": "ucal",
    "테디": "Teddy", "박진성": "Teddy", "テディ": "Teddy",
    "안딜": "Andil", "문관빈": "Andil", "アンディル": "Andil",

    # Dplus KIA
    "시우": "Siwoo", "シウ": "Siwoo",
    "루시드": "Lucid", "ルシッド": "Lucid",
    "쇼메이커": "ShowMaker", "허수": "ShowMaker", "ショーメーカー": "ShowMaker",
    "에이밍": "Aiming", "김하람": "Aiming", "エイミング": "Aiming",
    "베릴": "BeryL", "조건희": "BeryL", "ベリル": "BeryL",

    # KT Rolster
    "퍼펙트": "PerfecT", "パーフェクト": "PerfecT",
    "커즈": "Cuzz", "문우찬": "Cuzz", "カズ": "Cuzz",
    "비디디": "Bdd", "곽보성": "Bdd", "ビーディーディー": "Bdd",
    "덕담": "deokdam", "서대길": "deokdam", "ドクダム": "deokdam",

    # BNK FearX
    "클리어": "Clear", "クリア": "Clear",
    "랩터": "Raptor", "ラプター": "Raptor",
    "빅라": "VicLa", "ビクラ": "VicLa",
    "디아블": "Diable", "ディアブル": "Diable",
    "켈린": "Kellin", "ケリン": "Kellin",

    # Kwangdong Freecs
    "두두": "DuDu", "ドゥドゥ": "DuDu",
    "표식": "Pyosik", "홍창현": "Pyosik", "ピョシク": "Pyosik",
    "버서커": "Berserker", "バーサーカー": "Berserker",
    "라이프": "Life", "김정민": "Life", "ライフ": "Life",

    # NS RedForce
    "킹겐": "Kingen", "황성훈": "Kingen", "キンゲン": "Kingen",
    "실비": "Sylvie", "シルビー": "Sylvie",
    "지우": "Jiwoo", "ジウ": "Jiwoo",

    # OK BRION
    "모건": "Morgan", "モーガン": "Morgan",
    "함박": "HamBak", "ハムバク": "HamBak",
    "클로저": "Clozer", "クローザー": "Clozer",
    "폴루": "Pollu", "ポル": "Pollu",

    # 過去の有名選手
    "칸": "Khan", "김동하": "Khan", "カーン": "Khan",
    "뱅": "Bang", "배준식": "Bang", "バン": "Bang",
    "울프": "Wolf", "ウルフ": "Wolf",
    "스코어": "Score", "スコア": "Score",
    "마타": "Mata", "マタ": "Mata",
    "고릴라": "GorillA", "ゴリラ": "GorillA",
    "프레이": "PraY", "プレイ": "PraY",
    "데프트": "Deft", "김혁규": "Deft", "デフト": "Deft",
}


def create_correction_dict() -> dict:
    """全ての辞書を統合した修正辞書を作成."""
    corrections = {}
    corrections.update(CHAMPIONS)
    corrections.update(SKILLS)
    corrections.update(GAME_TERMS)
    corrections.update(ITEMS)
    corrections.update(TEAMS)
    corrections.update(PLAYERS)
    return corrections


def correct_text(text: str, corrections: dict = None) -> str:
    """テキストを辞書ベースで修正."""
    if corrections is None:
        corrections = create_correction_dict()

    result = text
    for wrong, correct in corrections.items():
        # 大文字小文字を無視して置換
        pattern = re.compile(re.escape(wrong), re.IGNORECASE)
        result = pattern.sub(correct, result)

    return result


def correct_srt_file(input_path: Path, output_path: Path = None):
    """SRTファイルを修正."""
    output_path = output_path or input_path.with_suffix(".corrected.srt")
    corrections = create_correction_dict()

    with open(input_path, "r", encoding="utf-8") as f:
        content = f.read()

    corrected = correct_text(content, corrections)

    with open(output_path, "w", encoding="utf-8") as f:
        f.write(corrected)

    print(f"修正完了: {output_path}")
    return output_path


def export_dictionary(path: Path = None):
    """辞書をJSONでエクスポート."""
    path = path or Path("./data/lol_dictionary.json")
    path.parent.mkdir(parents=True, exist_ok=True)

    data = {
        "champions": CHAMPIONS,
        "game_terms": GAME_TERMS,
        "items": ITEMS,
        "teams": TEAMS,
        "players": PLAYERS,
    }

    with open(path, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"辞書エクスポート: {path}")
    print(f"  チャンピオン: {len(CHAMPIONS)}件")
    print(f"  ゲーム用語: {len(GAME_TERMS)}件")
    print(f"  アイテム: {len(ITEMS)}件")
    print(f"  チーム: {len(TEAMS)}件")
    print(f"  選手: {len(PLAYERS)}件")


if __name__ == "__main__":
    export_dictionary()

    # テスト
    test_texts = [
        "아트록스가 잘하네",
        "사이온 풀콘 너무 빡세",
        "やばいtragedyだ",
        "ヨンジュンがやってくれたな",
        "イェチャン大変だったね",
    ]

    print("\n=== 修正テスト ===")
    for text in test_texts:
        corrected = correct_text(text)
        if text != corrected:
            print(f"  {text}")
            print(f"  → {corrected}")
            print()
